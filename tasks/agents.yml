---
- name: Manage Agents
  jenkins_script:
    script: "{{ lookup('template', 'agent.groovy') }}"
    url: "{{ jenkins.host }}"
    user: "{{ jenkins.user }}"
    password: "{{ jenkins.password }}"
    validate_certs: no
  register: state_result
  with_dict: "{{ jenkins.agents }}"
  changed_when: "'CHANGED' in state_result.output"
  failed_when: "'FAILED' in state_result.output"
